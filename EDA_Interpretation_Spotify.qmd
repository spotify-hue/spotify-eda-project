---
title: "EDA — Spotify Top 200 (2017–2023): Analysis & Interpretation"
format: html
execute:
  echo: true
  warning: false
  error: true
---

```{r setup}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(corrplot)

datafile <- "Spotify_Dataset_Cleaned-2(in) (1).csv"
spotify <- read_csv(datafile)

spotify <- spotify %>%
  mutate(Date = as_date(Date),
         Rank = as.integer(Rank),
         Danceability = as.numeric(Danceability),
         Energy = as.numeric(Energy),
         Loudness = as.numeric(Loudness),
         Speechiness = as.numeric(Speechiness),
         Acousticness = as.numeric(Acousticness),
         Instrumentalness = as.numeric(Instrumentalness),
         Valence = as.numeric(Valence),
         Points_Total = as.integer(`Points (Total)`)) %>%
  drop_na(Danceability, Energy, Loudness, Speechiness, Acousticness, Instrumentalness, Valence, Rank)

features <- c("Danceability","Energy","Loudness","Speechiness","Acousticness","Instrumentalness","Valence")
cor_df <- cor(spotify %>% select(all_of(features)), use = "pairwise.complete.obs")

nat_summary <- spotify %>%
  group_by(Nationality) %>%
  summarise(Avg_Rank = mean(Rank, na.rm = TRUE),
            Total_Points = sum(Points_Total, na.rm = TRUE),
            N = n()) %>%
  arrange(Avg_Rank)
```

# Exploratory Data Analysis — Distributions & Interpretations

## Danceability

```{r dance_plot}
ggplot(spotify, aes(Danceability)) + geom_histogram(bins = 40, fill = 'skyblue') +
  labs(title = "Distribution of Danceability", x = "Danceability Score", y = "Number of Songs")
```

**Interpretation — Danceability**

Most songs have danceability scores between **0.6 and 0.8**, meaning that top-charting songs are usually moderately to highly danceable. Songs with low danceability (below 0.3) are rare, suggesting rhythm and beat regularity are common features of popular music.

## Energy

```{r energy_plot}
ggplot(spotify, aes(Energy)) + geom_histogram(bins = 40, fill = 'orange') +
  labs(title = "Distribution of Energy", x = "Energy Score", y = "Number of Songs")
```

**Interpretation — Energy**

Energy values concentrate around **0.6–0.8**, showing many popular songs are lively and dynamic. Low-energy songs are uncommon in top charts.

## Loudness

```{r loudness_plot}
ggplot(spotify, aes(Loudness)) + geom_histogram(bins = 40, fill = 'lightgreen') +
  labs(title = "Distribution of Loudness", x = "Loudness (dB)", y = "Number of Songs")
```

**Interpretation — Loudness**

Most songs cluster near 0 dB, which follows modern mastering trends — loud tracks sound more intense and engaging, aligning with commercial production standards.

## Speechiness

```{r speech_plot}
ggplot(spotify, aes(Speechiness)) + geom_histogram(bins = 40, fill = 'purple') +
  labs(title = "Distribution of Speechiness", x = "Speechiness", y = "Number of Songs")
```

**Interpretation — Speechiness**

Most songs have low speechiness (<0.1), indicating that spoken-word content is rare in mainstream hits.

## Acousticness

```{r acoustic_plot}
ggplot(spotify, aes(Acousticness)) + geom_histogram(bins = 40, fill = 'red') +
  labs(title = "Distribution of Acousticness", x = "Acousticness", y = "Number of Songs")
```

**Interpretation — Acousticness**

The data is right-skewed: most songs are non-acoustic (0.0–0.2), showing that electronic and produced music dominate the charts.

## Instrumentalness

```{r inst_plot}
ggplot(spotify, aes(Instrumentalness)) + geom_histogram(bins = 40, fill = 'cyan') +
  labs(title = "Distribution of Instrumentalness", x = "Instrumentalness", y = "Number of Songs")
```

**Interpretation — Instrumentalness**

Instrumental-only tracks (values near 1.0) are rare. Most top-charting songs feature vocals.

## Valence

```{r valence_plot}
ggplot(spotify, aes(Valence)) + geom_histogram(bins = 40, fill = 'pink') +
  labs(title = "Distribution of Valence", x = "Valence (Positivity)", y = "Number of Songs")
```

**Interpretation — Valence**

Valence peaks between 0.4–0.6, suggesting most popular songs convey moderate emotional positivity, avoiding extremes of sadness or happiness.

# Distribution of Song Ranks (Popularity)

```{r rank_dist}
ggplot(spotify, aes(Rank)) + geom_histogram(bins = 50, fill = 'gray') +
  labs(title = "Distribution of Song Ranks", x = "Rank (1 = most popular)", y = "Number of Songs")
```

**Interpretation — Rank Distribution**

The rank distribution is **right-skewed**, meaning only a few songs reach the very top positions while most songs rank lower (near 200). Chart success is concentrated among a small number of top-performing tracks.

# Pairwise Relationships & Correlations

```{r cor_heatmap}
corrplot(cor_df, method = 'color', type = 'lower', tl.col = 'black', tl.srt = 45)
```

**Key correlations:**

- **Energy & Loudness (0.57):** louder songs are generally more energetic.
- **Energy & Acousticness (-0.57):** energetic songs tend to be less acoustic.
- **Danceability & Valence (0.33):** cheerful songs tend to be more danceable.
- **Loudness & Acousticness (-0.38):** acoustic songs are typically quieter.
- **Valence & Energy (0.36):** upbeat songs are also high-energy.
- **Danceability & Speechiness (0.24):** rhythmically spoken (rap-like) songs may also be danceable.

These relationships make musical sense: intensity and volume are correlated, while acoustic qualities oppose energy.

# Audio Features vs Rank (Popularity)

```{r feature_rank_plots}
features_rank <- c("Danceability", "Energy", "Loudness", "Speechiness", "Acousticness", "Instrumentalness", "Valence")
for (f in features_rank) {
  print(ggplot(spotify, aes_string(x = f, y = "Rank")) + geom_point(alpha = 0.15, color='steelblue') +
          geom_smooth(method='lm', se=FALSE, color='red') +
          labs(title = paste(f, "vs. Rank"), x = f, y = "Rank (1 = Top)"))
}
```

**Interpretation — Features vs Rank**

1. **Danceability vs Rank:** Mild concentration of top-ranked songs (lower rank values) at higher danceability (0.6–0.9), suggesting that danceable songs tend to perform slightly better.
2. **Energy vs Rank:** No strong pattern, though moderately-to-high energy tracks (0.5–0.8) appear more common among top ranks.
3. **Loudness vs Rank:** Louder songs (closer to 0 dB) are somewhat more represented among high-ranking songs.
4. **Speechiness vs Rank:** Most songs have low speechiness (<0.3); no clear trend, but extremely speech-heavy songs are less common.
5. **Acousticness vs Rank:** Top songs tend to have lower acousticness, indicating that less acoustic, more produced songs dominate the charts.
6. **Instrumentalness vs Rank:** High instrumentalness (no vocals) is rare and generally linked to lower popularity.
7. **Valence vs Rank:** No strong correlation; both happy and sad songs can chart well, though mid-valence (0.4–0.7) dominates among top songs.

# Nationality Analysis

```{r nationality_avg_rank}
ggplot(nat_summary, aes(x = reorder(Nationality, Avg_Rank), y = Avg_Rank)) +
  geom_col(fill = 'steelblue') +
  coord_flip() +
  labs(title = "Average Rank by Country", x = "Country", y = "Average Rank (Lower = Better)")
```

**Interpretation — Average Rank by Country**

Countries like **France** and **South Korea** achieve the **best average ranks**, meaning their songs perform more consistently well. The **United States** and **United Kingdom** have slightly higher average ranks, likely due to a larger number of releases. **Puerto Rico** and **Germany** rank lower, indicating less consistency in chart success.

```{r nationality_total_points}
ggplot(nat_summary, aes(x = reorder(Nationality, -Total_Points), y = Total_Points)) +
  geom_col(fill = 'darkorange') +
  coord_flip() +
  labs(title = "Total Points by Country", x = "Country", y = "Total Points (Sum of Chart Points)")
```

**Interpretation — Total Points by Country**

The **United States** dominates total points, showing global reach and volume of hits, followed by the **United Kingdom** and **South Korea**. **France** and **Italy** score fewer total points but have strong per-song performance. This suggests large markets excel by quantity, while smaller markets like **France** and **South Korea** succeed with high-quality, efficient hits.

# Overall Interpretation & Limitations

Popular songs tend to be **danceable, energetic, and loud**, while purely acoustic or instrumental songs are rare. However, individual features explain little about overall popularity. Nationality reveals production and market differences.

**Limitations:**
- Correlation ≠ causation.
- Missing external variables (marketing, artist fame, timing).
- No temporal analysis (trends may change yearly).
- Rank is only a relative proxy for success.

# Recommendations

1. Perform year-by-year EDA to capture evolving trends.
2. Include artist-level features for predictive modeling.
3. Examine interactions between features (e.g., Energy × Danceability).
4. Validate results with Spotify API popularity or stream count metrics.

---

*This `.qmd` now includes all rank distribution, feature-vs-rank plots, and nationality bar charts with detailed interpretations. It renders to HTML and is ready for GitHub publication.*
